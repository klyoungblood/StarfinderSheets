<!DOCTYPE html>
<html>
	<head>
	<style type="text/css"> 
	<meta charset="utf-8">
	input[type=text] {
	}
	
	.columns {
		column-count: 2;
	}
	
	.dot {
	height: 2em;
	width: 2em;
	background-color: #bbb;
	border-radius: 50%;
	display: inline-block;
	}
	
	.readout {
		border: 2px solid;
		border-radius: 50%;
	}

	input[type=checkbox] {
		margin: 1px;
	}
	
	button {
		border-radius: 1em;
	}
	
	.bigbutton {
		font-size: 120%;
	}

	@media print {
	  .nonprinting {
		visibility: hidden;
		display: none;
	  }
	}
	
	@media screen {
		.printonly {
		visibility: hidden;
		display: none;
	  }
	}	

	.invisible{
		display: none;
	}

	.fixedcontrols{
		position: fixed;
		top: 0;
		left: 0;
		background-color: white;
		border: 1px solid;
	}

	.breaking{
		break-before: always;
	}

	.top-aligned{
		vertical-align: top;
	}

	.bottom-aligned{
		vertical-align: bottom;
	}
	
	.middle-aligned{
		vertical-align: middle;
	}

	.input_u{
		border: none;
		border-bottom: 1px solid;
		text-align: left;
		font-weight: bold;
	}

	.input_w{
		border: none;
		text-align: center;
	}


	.input_ubig{
		font-size: 1.2em;
		border: none;
		border-bottom: 1px solid;
		text-align: center;
		width: 100%;
	}

	.input_b{
		border: 1px solid;
		border-radius: 0.5em;
		text-align: center;
		font-weight: bold;
	}
	
	.input_s{
		border: 1px solid;
		border-radius: 0.5em;
		text-align: center;
		font-weight: bold;
		width: 5em;
	}
	
	.bordered {
		border: 2px solid;
		border-radius: 0.5em;
	}

	.thinbordered{
		border: 1px solid;
		border-radius: 0.5em;
	}

	.halfwidth {
		width: 48%;
	}

	.twentyfive {
		width: 25%;
	}

	textarea {
		resize: none;
		width: 98%;
		overflow: auto;
		font-family: sans-serif;
		border: 1px solid;
		border-radius: 0.5em;
	}

	.fullwidth {
		width: 100%;
	}

	.onethirdwidth {
		width: 33%;
	}

	body {
		font-family: sans-serif;
		font-variant: small-caps;
	}

	.right-aligned {
		text-align: right;
	}

	th {
		vertical-align: bottom;
		font-variant: small-caps;
	}

	td {
		font-variant: small-caps;
		white-space: nowrap;
	}
	
	.wrap {
		white-space: normal;
	}

	.nobreak {
		white-space: nowrap;
		display: inline-block;
	}

	h3 {
		font-size: 1.2em;
		display: inline-block;
		padding: 0.1em;
		font-variant: small-caps;
		margin-top: 0em;
		margin-bottom: 0em;
	}

	h4 {
		font-family: monospace;
		font-size: 1.2em;
		margin-top: 0em;
		margin-bottom: 0em;
		margin-left: 0;
		margin-right: 0;
		font-weight: bold;
		display: inline-block;
		padding: 0.075em;
		font-variant: small-caps;
	}

	h6 {
		margin-top: 0em;
		margin-bottom: 0em;
		margin-left: 0;
		margin-right: 0;
		font-weight: normal;
		font-variant: small-caps;
	}
	
	</style>
	<script>
	function AttachListeners(){
		var inputs = document.getElementsByTagName("input");
		var areas = document.getElementsByTagName("textarea");
		var selects = document.getElementsByTagName("select");
		for(var i=0; i < inputs.length; i++)
		{
			inputs[i].addEventListener("change", UpdateDLLink);
		}
		
		for(var i=0; i < areas.length; i++)
		{
			areas[i].addEventListener("change", UpdateDLLink);
		}
		
		for(var i=0; i < selects.length; i++)
		{
			selects[i].addEventListener("change", UpdateDLLink);
		}

	}
	
	function PopulateNameAndID()
	{
		var shipname = document.getElementById("Shipname").value;
		var shiptier = document.getElementById("Shiptier").value;
		
		document.getElementById("Shipname2").value = shipname;
		document.getElementById("Shiptier2").value = shiptier;
	}
	
	// Hex math defined here: http://blog.ruslans.com/2011/02/hexagonal-grid-math.html

	function HexagonGrid(canvasId, radius) {
		this.radius = radius;

		this.height = Math.sqrt(3) * radius;
		this.width = 2 * radius;
		this.side = (3 / 2) * radius;

		this.canvas = document.getElementById(canvasId);
		this.context = this.canvas.getContext('2d');

		this.canvasOriginX = 0;
		this.canvasOriginY = 0;
	};

	HexagonGrid.prototype.drawHexGrid = function (rows, cols, originX, originY, isDebug) {
		this.canvasOriginX = originX;
		this.canvasOriginY = originY;
		
		var currentHexX;
		var currentHexY;
		var debugText = "";

		var offsetColumn = false;

		for (var col = 0; col < cols; col++) {
		    for (var row = 0; row < rows; row++) {

		        if (!offsetColumn) {
		            currentHexX = (col * this.side) + originX;
		            currentHexY = (row * this.height) + originY;
		        } else {
		            currentHexX = col * this.side + originX;
		            currentHexY = (row * this.height) + originY + (this.height * 0.5);
		        }

		        if (isDebug) {
		            debugText = col + "," + row;
		        }

				if((row==2||row==5) && (col==2||col==4))
			        this.drawHex(currentHexX, currentHexY, "grey", debugText);
			    else
				    this.drawHex(currentHexX, currentHexY, "white", debugText);
		    }
		    offsetColumn = !offsetColumn;
		}
	};

	HexagonGrid.prototype.drawHexAtColRow = function(column, row, color) {
		var drawy = column % 2 == 0 ? (row * this.height) + this.canvasOriginY : (row * this.height) + this.canvasOriginY + (this.height / 2);
		var drawx = (column * this.side) + this.canvasOriginX;

		this.drawHex(drawx, drawy, color, "");
	};

	HexagonGrid.prototype.drawHex = function(x0, y0, fillColor, debugText) {
		this.context.strokeStyle = "#000";
		this.context.beginPath();
		this.context.moveTo(x0 + this.width - this.side, y0);
		this.context.lineTo(x0 + this.side, y0);
		this.context.lineTo(x0 + this.width, y0 + (this.height / 2));
		this.context.lineTo(x0 + this.side, y0 + this.height);
		this.context.lineTo(x0 + this.width - this.side, y0 + this.height);
		this.context.lineTo(x0, y0 + (this.height / 2));

		if (fillColor) {
		    this.context.fillStyle = fillColor;
		    this.context.fill();
		}

		this.context.closePath();
		this.context.stroke();

		if (debugText) {
		    this.context.font = "8px";
		    this.context.fillStyle = "#000";
		    this.context.fillText(debugText, x0 + (this.width / 2) - (this.width/4), y0 + (this.height - 5));
		}
	};

	//Recusivly step up to the body to calculate canvas offset.
	HexagonGrid.prototype.getRelativeCanvasOffset = function() {
		var x = 0, y = 0;
		var layoutElement = this.canvas;
		if (layoutElement.offsetParent) {
		    do {
		        x += layoutElement.offsetLeft;
		        y += layoutElement.offsetTop;
		    } while (layoutElement = layoutElement.offsetParent);
		    
		    return { x: x, y: y };
		}
	}

	//Uses a grid overlay algorithm to determine hexagon location
	//Left edge of grid has a test to acuratly determin correct hex

	HexagonGrid.prototype.sign = function(p1, p2, p3) {
		return (p1.x - p3.x) * (p2.y - p3.y) - (p2.x - p3.x) * (p1.y - p3.y);
	};

	//TODO: Replace with optimized barycentric coordinate method
	HexagonGrid.prototype.isPointInTriangle = function isPointInTriangle(pt, v1, v2, v3) {
		var b1, b2, b3;

		b1 = this.sign(pt, v1, v2) < 0.0;
		b2 = this.sign(pt, v2, v3) < 0.0;
		b3 = this.sign(pt, v3, v1) < 0.0;

		return ((b1 == b2) && (b2 == b3));
	};

	function DrawReadout()
	{
		var HexGrid = new HexagonGrid('readout',20);
		HexGrid.drawHexGrid(10, 10, -10, -37, false);
		readout=document.getElementById("readout");
		var c=readout.getContext("2d");
		c.lineWidth=3;

		c.beginPath();
		c.moveTo(90,84);
		c.lineTo(50,14);
		c.stroke();
		
		c.moveTo(110,84);
		c.lineTo(150,14);
		c.stroke();
		
		c.moveTo(90,119);
		c.lineTo(50,189);
		c.stroke();
		
		c.moveTo(110,119);
		c.lineTo(150,189);
		c.stroke();
		
		c.font="25px Sans";
		c.textAlign="center";
		c.textBaseline="middle";
		c.lineWidth=1; 
		c.fillStyle="Black";
		c.save();
		c.translate(100,100);
		c.rotate(45*Math.PI/180);
		c.fillText("ðŸš€",0,0);
		c.restore();

	}
	
	function LoadFile(){
		loadbox=document.getElementById('inputfile');
		var file=loadbox.files[0];
		if (!file) {
			return;
		}
		ClearInputs();
		var reader = new FileReader();
		reader.onloadend = function(e) {
			var contents = JSON.parse(e.target.result);
			for (const [ key, value ] of Object.entries(contents)) {
				thing = document.getElementById(key);
				if(thing)
				{
					if(thing.type && thing.type == 'checkbox' && value == true)
						thing.checked = true;
					else
						thing.value=value;
				}
			}
			PopulateNameAndID();
			UpdateDLLink();
		};
		reader.readAsText(file);
	}
	
	function ClearInputs(){
		var charvars = document.querySelectorAll("input[type=text]");
		var longvars = document.getElementsByTagName("textarea");
		var boolvars = document.querySelectorAll("input[type=checkbox]");
		
		for(var i=0; i < charvars.length; i++)
		{
			charvars[i].value = "";
		}
		
		for(var i=0; i < longvars.length; i++)
		{
			longvars[i].value = "";
		}
		
		for(var i=0; i < boolvars.length; i++)
		{
			boolvars[i].checked = false;
		}
		
	}

	function UpdateDLLink(){
		var cjson = {};
		var shipname = document.getElementById("Shipname").value;
		var charvars = document.querySelectorAll("input[type=text]");
		var longvars = document.getElementsByTagName("textarea");
		var boolvars = document.querySelectorAll("input[type=checkbox]");
		
		if(shipname=="")
			shipname = "Unnamed Ship";
		
		for(var i=0; i < charvars.length; i++)
		{
			cjson[charvars[i].id]=charvars[i].value;
		}
		
		for(var i=0; i < longvars.length; i++)
		{
			cjson[longvars[i].id]=longvars[i].value;
		}
		
		for(var i=0; i < boolvars.length; i++)
		{
			if(boolvars[i].checked)
			{
				cjson[boolvars[i].id]=true;
			}
		}
		
		var cstring=JSON.stringify(cjson);
		var charblob = new Blob([cstring], {type: "application/json"});
		var url = URL.createObjectURL(charblob);
		
		var a = document.createElement('a');
		a.download    = shipname+".json";
		a.href        = url;
		a.textContent = "Save";
			
		document.getElementById('DownloadLink').innerHTML=""
		document.getElementById('DownloadLink').appendChild(a);
	}
	</script>
	<title>Starfinder Ship Sheet</title>
	</head>
	<body>
		<span class="nonprinting fixedcontrols">
			Load:<input type="file" id="inputfile" onchange="LoadFile()">
			<span id="DownloadLink"></span>
		</span>
		<table class="fullwidth">
		<tr>
			<td><h2>Starfinder</h2></td>
			<td class="halfwidth"><input type="text" id="Shipname" class="input_ubig" onchange="PopulateNameAndID()"><br />Ship Name</td>
			<td class="twentyfive"><input type="text" id="Shiptier" class="input_ubig" onchange="PopulateNameAndID()"><br />Tier</td>
			<td class="right-aligned"><h2>Page 1</h2>
		</tr>
		</table>
		<table class="bordered">
			<tr>
				<th colspan="3"><h3>Shields</h3></td>
			</tr>
			<tr>
				<td></td>
				<th>
					<h4>Forward</h4><br><input type="text" id="ShieldForeCur" class="input_s">/<input type="text" id="ShieldForeTotal" class="input_s">
				</th>
				<td></td>
			</tr>		
			<tr>
				<th class="middle-aligned"><h4>Port</h4><br><input type="text" id="ShieldPortCur" class="input_s">/<input type="text" id="ShieldPortTotal" class="input_s">
				<th><canvas class="readout" id="readout" width="200" height="200"></canvas></th>
				<th class="middle-aligned"><h4>Starboard</h4><br><input type="text" id="ShieldSBCur" class="input_s">/<input type="text" id="ShieldSBTotal" class="input_s"></th>
			</tr>
			<tr>
				<td></td>
				<th><h4>Aft</h4><br><input type="text" id="ShieldAftCur" class="input_s">/<input type="text" id="ShieldAftTotal" class="input_s"></th>
				<td></td>
			</tr>
		</table>
		<p style='overflow:hidden;page-break-before:always;'></p>
		<table class="fullwidth">
			<tr>
				<td><h2>Starfinder</h2></td>
				<td class="halfwidth"><input type="text" id="Shipname2" class="input_ubig" disabled><br />Ship Name</td>
				<td class="twentyfive"><input type="text" id="Shiptier2" class="input_ubig" disabled><br />Tier</td>
				<td class="right-aligned"><h2>Page 2</h2></td>
			</tr>
		</table>
		<h2>Crew Actions</h2>
		<div class="columns">
		<span class="nocbreak">
			<h3>Captain</h3>
			<ul>
				<li><b>Demand</b>: Intimidate <span class="DC15plus150"></span></li>
				<li><b>Encourage</b>: Diplomacy [DC 15] or same skill as action encouraged [DC 10]</li>
				<li><b>Taunt</b>*: Bluff or Intimidate <span class="DC15Plus150Enemy"></span></li>
				<li><b>Orders</b>&dagger;: Computers, Engineering, Gunnery, or Piloting (6th level) <span class="DC15plus150"></span></li>
				<li><b>Moving Speech</b>&dagger;: Diplomacy (12th level) <span class="DC20plus150"></span></li>
			</ul>
		</span>
		<span class="nocbreak">
			<h3>Engineer</h3>
			<ul>
				<li><b>Divert</b>: Engineering <span class="DC10plus150"></span></li>
				<li><b>Hold it Together</b>: Engineering <span class="DC15plus150"></span></li>
				<li><b>Patch</b>: Engineering <span class="DC10plus150"></span> if glitching, <span class="DC15plus150"></span> if malfunctioning, <span class="DC20plus150"></span> if wrecked.</li>
			</ul>
		</span>
		<span class="nocbreak">
			<h3>Pilot</h3>
			<ul>
				<li><b>Back Off</b>: Piloting <span class="DC10plus150"></span></li>
				<li><b>Barrel Roll</b>: Piloting <span class="DC10plus150"></span></li>
				<li><b>Evade</b>: Piloting <span class="DC10plus150"></span></li>
				<li><b>Flip and Burn</b>: Piloting <span class="DC15plus150"></span></li>
				<li><b>Flyby</b>: Piloting <span class="DC15plus150"></span></li>
				<li><b>Slide</b>: Piloting <span class="DC10plus150"></span></li>
				<li><b>Maneuver</b>: Piloting <span class="DC15plus150"></span></li>
				<li><b>Full Power</b>&dagger;: Piloting (6 ranks) No check</li>
				<li><b>Audacious Gambit</b>&dagger;: Piloting (12 ranks) <span class="DC20plus150"></span></li>
			</ul>
		</span>
		<span class="nocbreak">
			<h3>Science Officer</h3>
			<ul>
				<li><b>Balance</b>: Computers <span class="DC10plus150"></span></li>
				<li><b>Scan</b>*: Computers <span class="DC5Plus150Enemy"></span></li>
				<li><b>Target System</b>*: Computers <span class="DC5Plus150Enemy"></span></li>
				<li><b>Lock On</b>*&dagger;: Computers (6 ranks) <span class="DC5Plus150Enemy"></span></li>
				<li><b>Improve Countermeasures</b>*&dagger;: Computers (12 ranks) <span class="DC5Plus150Enemy"></span></li>
			</ul>
			</div>
		</span>
		<p>*: DC depends on tier of enemy ship.</p>
		<p>&dagger;: Action costs resolve.</p>
	</body>
	<h3>Community Use Policy</h3><br>This character sheet uses trademarks and/or copyrights owned by Paizo Inc., which are used under Paizo's Community Use Policy. We are expressly prohibited from charging you to use or access this content. This character sheet is not published, endorsed, or specifically approved by Paizo Inc. For more information about Paizo's Community Use Policy, please visit <a href="http://paizo.com/paizo/about/communityuse">paizo.com/communityuse</a>. For more information about Paizo Inc. and Paizo products, please visit <a href="http://paizo.com/">paizo.com</a>.
	<script>AttachListeners()</script>
	<script>DrawReadout()</script>
</body>
</html>

